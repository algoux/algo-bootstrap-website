<script lang="ts">
import { Vue } from 'vue-class-component';
import { Prop } from 'vue-property-decorator';
import macOS from '@client/assets/images/macos.png';
import windows from '@client/assets/images/windows.png';
import download from '@client/assets/images/download.png';
import platformUtil from '@client/utils/platform.util';
import { ReleasesConfig } from '@client/utils/data.config';

export default class DownloadButton extends Vue {
  @Prop({ type: String, default: 'Windows' }) platform!: string;
  @Prop({ type: String, default: "arm64"}) arch!: string;
  @Prop({ type: Boolean, default: false }) isHome: Boolean;

  isSupportedPlatform = this.platform === 'windows' || this.platform === 'mac';

  isUnsupportedPlatform = this.platform !== 'windows' && this.platform !== 'mac';

  get platformName(): string {
    return this.platform === 'mac' ? 'macOS' : 'Windows';
  }

  get platformImage(): string {
    switch (this.platform) {
      case 'windows':
        return windows;
      case 'mac':
        return macOS;
      default:
        return download;
    }
  }

  private handleDownload() {
    const version = process.env.VITE_VERSION;
    const releasesConfig = new ReleasesConfig(version as string);
    let downloadLink = releasesConfig.downloadSingleSystemLink(this.platform, this.arch);
    console.log("Download link:", downloadLink);
    // window.open(downloadLink, '_blank');
  }
}
</script>

<template>
  <div class="btn-container">
    <button class="download btn" @click="handleDownload">
      <img :src="platformImage" alt="" />
      {{ isUnsupportedPlatform && isHome ? '下载可用版本' : '下载 ' + platformName + " 版本" }}
    </button>
    <span class="download-all-platforms" v-if="isSupportedPlatform && isHome">
      下载 <router-link class="link" to="/releases">其他平台</router-link> 版本
    </span>
    <span class="download-all-platforms" v-if="isUnsupportedPlatform && isHome"
      >仅支持 Windows 和 macOS.</span
    >
  </div>
</template>

<style scoped lang="less">
.btn-container {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.download-all-platforms {
  position: absolute;
  bottom: 0;
  color: var(--font-secondary-color);
  font-size: var(--font-small-size);
  transform: translateY(38px);

  @media screen and (max-width: 768px) {
    transform: translateY(150%);
  }

  & .link {
    color: var(--font-primary-color);
  }
}
.btn {
  padding: 10px 15px;
  position: relative;
  @media screen and (min-width: 768px) {
    padding: 15px 20px;
  }
  @media screen and (min-width: 1700px) {
    padding: 20px 25px;
  }
  background-color: transparent;
  border: none;
  outline: none;
  border-radius: 100px;
  font-size: var(--font-small-size);
  font-weight: 600;
  text-decoration: none;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 6px;
}

.download {
  background-color: #fff;
  color: #000;
  cursor: pointer;
  transition: background-color 0.3s ease;
  border: 2px solid transparent;
  outline: 2px solid var(--glass-border-color);

  & img {
    height: calc(var(--font-small-size) * 1.5);
  }

  &:hover {
    background-color: #dddddd;
  }
}
</style>
